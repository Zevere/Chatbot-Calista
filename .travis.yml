dist: trusty

sudo: required

branches:
  except:
  - gh-pages

notifications:
  email: false

language: node_js
node_js:
  - node

cache:
  directories:
    - node_modules

services:
  - docker

before_install:
  - sudo apt-get install build-essential
  - sudo apt-get install snapd

install:
  - cd scripts && npm ci && cd ..
  - make install

script:
  - make build

deploy:
  - provider: script
    skip_cleanup: true
    script: node scripts/deploy Staging
    on:
      branch: develop

  - provider: script
    skip_cleanup: true
    script: node scripts/deploy Production
    on:
      branch: master

env:
  # DEPLOY_SETTINGS_JSON='{"Staging":[ /* ... */ ]}'
  - secure: irbCrTXX9gsaoTJWwzQmVakBwr9zxQQ0k/WD4eP+ZfmjBci8tghWewoSo0Ng++DM1bUN0sWBV69ky+mCQWsvEvanKM+eTciYbVeo3TKJmzRV0fu75mKpYG4iJFDu26bxIBX7hQtuovCEOykODBSPJNugkBe0jKqkKuItggYhOb85ODtz0HY/qlsXD/VnY8fuVFtGYtTf8VYoYfpiCvDtgC/snObFap9DC5GMTqvtp+s+JYHwASatSIyaL6tq4dTVjjolpT1zNkAEDnXFNoEHFVU00AxvGOnQry2EezXZOs3Ao2899t/KObIpavuxu9FT7dw+pI0mfnwtLrWRjGnGEB8Ll8UmnDwAyAYqnspyCBcdgjG/7kTsEDms893Alt9EQ/TPJP+7n+tyR048SPSLeaPBjn6zY0crvG/hnBL1lQl6BM69fXAKurA2c+RriZPCklMsCkNTAbZpB06rqD5jN0l0hqZpaolYunaF54SCiikzFKbtrsYAM02CEHTgA3GceX5yKDxQnpSgANLj7l2jgDtj1arlt6zYvSc5yYQdxJ/Dm8bBo+jYfG7sGVL1bafaO6jSZD9CF7skjvpF19pgYY++10wHK1Felfduy+1CX3TjbGRAHRIOP3MVsH/bjljVj/q++iGfyx7nGAjFevU3E72kqV1XRQn+s+PZOnm0WT0=


# Disable "Build pushed pull requests"

# env:
#   DEPLOY_SETTINGS_JSON: A mapping of environment to the deployment types and their options.
#   {
#     "Staging": [
#       { "type": "docker",
#         "options": { "source": "foo:edge", "target": "foo/bar:latest", "user": "foo", "pass": "PASS" }
#       },
#       { "type": "heroku",
#         "options": {
#           "app": "foo-staging", "source": "foo:latest", "dyno": "web", "user": "foo@example.org", "token": "TOKEN"
#         }
#       }
#     ],
#     "Production": [ ]
#   }
